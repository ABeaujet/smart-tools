/**
 * All rights reserved, Gemalto Inc
 * license at http://www.sconnect.com/install/license.htm
 * @author Kapil Sachdeva
 */

var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(D){for(var A=0;A<D.length;A++){var B=D[A].string;var C=D[A].prop;this.versionSearchString=D[A].versionSearch||D[A].identity;if(B){if(B.indexOf(D[A].subString)!=-1){return D[A].identity}}else{if(C){return D[A].identity}}}},searchVersion:function(B){var A=B.indexOf(this.versionSearchString);if(A==-1){return }return parseFloat(B.substring(A+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();var SConnect={};SConnect.Version="1.0.12.0";SConnect.RegisterNamespace=function(D){var E=window;var A=D.split(".");for(var C=0;C<A.length;C++){var B=A[C];if(!E[B]){E[B]={}}E=E[B]}};SConnect.TypeUtils=function(){};SConnect.TypeUtils.byteToSbyte=function(A){if(A>127){return(A-255-1)}return A};SConnect.TypeUtils.ushortToShort=function(A){if(A>32767){return(A-65535-1)}return A};SConnect.TypeUtils.uintToInt=function(A){if(A>2147483647){return(A-4294967295-1)}return A};SConnect.TypeUtils.ulongToLong=function(A){if(A>9223372036854776000){return(A-18446744073709552000-1)}return A};SConnect.TypeUtils.utf8Encode=function(C){var A=0;var E=0;var B=[];for(A=0;A<C.length;A++){var D=C.charCodeAt(A);if(D<128){B[E]=D;E++}else{if(D<=2047){B[E]=(192+(D>>6));B[E+1]=(128+(D%64));E+=2}else{if(D<=65535){B[E]=(224+(D>>12));B[E+1]=(128+((D>>6)%64));B[E+2]=(128+(D%64));E+=3}else{if(D<=2097151){B[E]=(240+(D>>18));B[E+1]=(128+((D>>12)%64));B[E+2]=(128+((D>>6)%64));B[E+3]=(128+(D%64));E+=4}}}}}return B};SConnect.TypeUtils.utf8Decode=function(E,D,B){var A=0;var C="";for(A=0;A<B;){if((E[A+D]&128)===0){C+=String.fromCharCode(E[A+D]);A+=1}else{if((E[A+D]&224)===192){C+=String.fromCharCode(((E[A+D]&31)<<6)|(E[A+1+D]&63));A+=2}else{if((E[A]&240)==224){C+=String.fromCharCode(((E[A+D]&15)<<12)|((E[A+1+D]&63)<<6)|(E[A+2+D]&63));A+=3}}}}return C};SConnect.TypeUtils.byteArrayToHexString=function(B){var D="";for(var C=0;C<B.length;C++){var A=B[C].toString(16);if(A.length<2){D+="0"}D+=A}return D};SConnect.TypeUtils.myCharCodeAt=function(D,A){var C=D.substring(A,A+1);for(var B=1;B<=255;B++){if(unescape("%"+B.toString(16))==C){return B}}return 0};SConnect.TypeUtils.hexStringToByteArray=function(E){var H=[];var F="";F+=E;for(var D=0;D<F.length;D+=2){var G=this.myCharCodeAt(F,D);var B,A;if(G<65){B=(G-48)}else{if(G<97){B=(G-65+10)}else{B=(G-97+10)}}var C=this.myCharCodeAt(F,D+1);if(C<65){A=(C-48)}else{if(C<97){A=(C-65+10)}else{A=(C-97+10)}}H[D/2]=((B<<4)|A)}return H};function SCardScope(){}SCardScope.User=0;SCardScope.Terminal=1;SCardScope.System=2;function SCardAccessMode(){}SCardAccessMode.Exclusive=1;SCardAccessMode.Shared=2;SCardAccessMode.Direct=3;function SCardContextScope(){}SCardContextScope.User=0;SCardContextScope.Terminal=1;SCardContextScope.System=2;function SCardControlCodes(){}SCardControlCodes.Power=3211268;SCardControlCodes.GetAttribute=3211272;SCardControlCodes.SetAttribute=3211276;SCardControlCodes.Confiscate=3211280;SCardControlCodes.Transmit=3211284;SCardControlCodes.Eject=3211288;SCardControlCodes.Swallow=3211292;SCardControlCodes.Read=3211296;SCardControlCodes.Write=3211300;SCardControlCodes.Present=3211304;SCardControlCodes.Absent=3211308;SCardControlCodes.Protocol=3211312;SCardControlCodes.State=3211320;SCardControlCodes.GetLastError=3211324;SCardControlCodes.GetPerfCntr=3211328;function SCardDisposition(){}SCardDisposition.LeaveCard=0;SCardDisposition.ResetCard=1;SCardDisposition.UnpowerCard=2;SCardDisposition.EjectCard=3;SCardDisposition.Confiscate=4;function SCardReaderState(){}SCardReaderState.Unknown=0;SCardReaderState.Absent=1;SCardReaderState.Present=2;SCardReaderState.Swallowed=3;SCardReaderState.Powered=4;SCardReaderState.Negotiable=5;SCardReaderState.Specific=6;function SCardResponseCode(){}SCardResponseCode.InternalError=2148532225;SCardResponseCode.Cancelled=2148532226;SCardResponseCode.InvalidHandle=2148532227;SCardResponseCode.InvalidParameter=2148532228;SCardResponseCode.InvalidTarget=2148532229;SCardResponseCode.NoMemory=2148532230;SCardResponseCode.WaitedTooLong=2148532231;SCardResponseCode.InsufficientBuffer=2148532232;SCardResponseCode.UnknownReader=2148532233;SCardResponseCode.Timeout=2148532234;SCardResponseCode.SharingViolation=2148532235;SCardResponseCode.NoSmartCard=2148532236;SCardResponseCode.UnknownCard=2148532237;SCardResponseCode.CanotDispose=2148532238;SCardResponseCode.ProtoMismatch=2148532239;SCardResponseCode.NotReady=2148532240;SCardResponseCode.InvalidValue=2148532241;SCardResponseCode.SystemCancelled=2148532242;SCardResponseCode.CommError=2148532243;SCardResponseCode.UnkownError=2148532244;SCardResponseCode.InvalidATR=2148532245;SCardResponseCode.NotTransacted=2148532246;SCardResponseCode.ReaderUnavailable=2148532247;SCardResponseCode.ShutDown=2148532248;SCardResponseCode.PCITooSmall=2148532249;SCardResponseCode.ReaderUnSupported=2148532250;SCardResponseCode.DuplicateReader=2148532251;SCardResponseCode.CardUnSupported=2148532252;SCardResponseCode.NoService=2148532253;SCardResponseCode.ServiceStopped=2148532254;SCardResponseCode.UnExpected=2148532255;SCardResponseCode.ICCInstallation=2148532256;SCardResponseCode.ICCCreateOrder=2148532257;SCardResponseCode.UnsupportedFeature=2148532258;SCardResponseCode.DirectoryNotFound=2148532259;SCardResponseCode.FileNotFound=2148532260;SCardResponseCode.NotADirectory=2148532261;SCardResponseCode.NotAFile=2148532262;SCardResponseCode.NoAccess=2148532263;SCardResponseCode.WriteTooMany=2148532264;SCardResponseCode.BadSeek=2148532265;SCardResponseCode.InvalidCHV=2148532266;SCardResponseCode.UnknownResMng=2148532267;SCardResponseCode.NoSuchCertificate=2148532268;SCardResponseCode.CertificateUnavailabe=2148532269;SCardResponseCode.NoReadersAvailable=2148532270;SCardResponseCode.CommDataLost=2148532271;SCardResponseCode.NoKeyContainer=2148532272;SCardResponseCode.ServerTooBusy=2148532273;SCardResponseCode.UnsupportedCard=2148532325;SCardResponseCode.UnresponsiveCard=2148532326;SCardResponseCode.UnpoweredCard=2148532327;SCardResponseCode.ResetCard=2148532328;SCardResponseCode.RemovedCard=2148532329;SCardResponseCode.SecurityViolation=2148532330;SCardResponseCode.WrongCHV=2148532331;SCardResponseCode.CHVBlocked=2148532332;SCardResponseCode.EOF=2148532333;SCardResponseCode.CancelledByUser=2148532334;SCardResponseCode.CardNotAuthenticated=2148532335;function SCardTrackStates(){}SCardTrackStates.AtrMatch=64;SCardTrackStates.Changed=2;SCardTrackStates.Empty=16;SCardTrackStates.Exclusive=128;SCardTrackStates.Ignore=1;SCardTrackStates.InUse=256;SCardTrackStates.Mute=512;SCardTrackStates.Present=32;SCardTrackStates.Unavailable=8;SCardTrackStates.Unaware=0;SCardTrackStates.Unknown=4;SCardTrackStates.Unpowered=1024;function SCardProtocolIdentifiers(){}SCardProtocolIdentifiers.Default=-2147483648;SCardProtocolIdentifiers.Optimal=0;SCardProtocolIdentifiers.Raw=65536;SCardProtocolIdentifiers.T0=1;SCardProtocolIdentifiers.T1=2;SCardProtocolIdentifiers.Undefined=0;SConnect.SCardStatus=function(){this.Protocol=0;this.State=0;this.ATR=null};SConnect.ExtensionVersion=function(){this.Major=0;this.Minor=0;this.Build=0;this.Revision=0};SConnect.Installer=function(){};SConnect.Installer.firefox=function(){};SConnect.Installer.firefox.prototype={loc:"http://www.sconnect.com/extensions/sconnect-moz-v1.0.12.0-##.xpi",updateRequired:false,isSupported:function(){if(BrowserDetect.OS=="Windows"){this.loc=this.loc.replace("##","win");return true}else{if(BrowserDetect.OS=="Linux"){this.loc=this.loc.replace("##","lx");return true}else{if(BrowserDetect.OS=="Mac"){this.loc=this.loc.replace("##","mac");return true}}}return false},isInstalled:function(C){var E=null;try{E=new nsSConnect()}catch(D){return false}if(C){var B=null;try{B=E.Version();var A=SConnect.TypeUtils.hexStringToByteArray(B);if((A[0]<1)||(A[1]<0)||(A[2]<12)||(A[3]<0)){this.updateRequired=SConnect.updateRequired=true;return false}}catch(D){this.updateRequired=SConnect.updateRequired=true;return false}this.updateRequired=SConnect.updateRequired=true}return true},doInstall:function(){if(this.isSupported()){var C=this.loc;var B=[];B["SConnect 1.0.12.0 Beta1"]={URL:C,IconURL:"http://www.sconnect.com/install/images/chip.png",toString:function(){return this.URL}};var A=InstallTrigger.install(B);if(A){}else{SConnect._createFirefoxHelpDialog()}}else{SConnect._createNotSupportedDialog()}}};SConnect.Installer.safari=function(){};SConnect.Installer.safari.prototype={isSupported:function(){if(BrowserDetect.OS=="Mac"){return true}return false},isInstalled:function(A){if(navigator.mimeTypes["application/x-sconnectwebkitplugin"]){return true}return false}};SConnect.Installer.ie=function(){};SConnect.Installer.ie.prototype={loc:"http://www.sconnect.com/extensions/sconnect-ie-v1.0.12.0.exe",updateRequired:false,isSupported:function(){if(BrowserDetect.OS=="Windows"){return true}return false},isInstalled:function(C){var E=null;try{E=new ActiveXObject("SConnectLib.SConnect")}catch(D){return false}if(C){var B=null;try{B=E.Version();var A=SConnect.TypeUtils.hexStringToByteArray(B);if((A[0]<1)||(A[1]<0)||(A[2]<12)||(A[3]<0)){this.updateRequired=SConnect.updateRequired=true;return false}}catch(D){this.updateRequired=SConnect.updateRequired=true;return false}this.updateRequired=SConnect.updateRequired=true}return true},doInstall:function(){if(this.isSupported()){document.location.href=this.loc}else{SConnect._createNotSupportedDialog()}}};SConnect.IsInstalled=function(){if(BrowserDetect.browser=="Explorer"){return new SConnect.Installer.ie().isInstalled(true)}else{if(BrowserDetect.browser=="Firefox"){return new SConnect.Installer.firefox().isInstalled(true)}else{if(BrowserDetect.browser=="Safari"){return new SConnect.Installer.safari().isInstalled(true)}}}return false};SConnect._doInstall=function(){SConnect._destroyWindow();if(BrowserDetect.browser=="Explorer"){new SConnect.Installer.ie().doInstall()}else{if(BrowserDetect.browser=="Firefox"){new SConnect.Installer.firefox().doInstall()}else{SConnect._createNotSupportedDialog()}}};SConnect._createStyleSheet=function(C,F){var B;var A=document.getElementsByTagName("head")[0];var E=document.createElement("style");E.setAttribute("type","text/css");if(F){E.setAttribute("id",F)}if(BrowserDetect.browser=="Explorer"){A.appendChild(E);B=E.styleSheet;B.cssText=C}else{try{E.appendChild(document.createTextNode(C))}catch(D){E.cssText=C}A.appendChild(E);B=E.styleSheet?E.styleSheet:(E.sheet||document.styleSheets[document.styleSheets.length-1])}return B};SConnect._destroyWindow=function(){try{document.body.removeChild(document.getElementById("sconnect_install_overlay"));document.body.removeChild(document.getElementById("sconnect_install_window"))}catch(A){}};SConnect._createWindow=function(A){var K=document.createElement("div");K.style.opacity=0.5;K.style.width="100%";K.style.height="100%";K.id="sconnect_install_overlay";K.style.filter="alpha(opacity="+(0.5)*100+")";document.body.appendChild(K);var F=document.createElement("div");F.setAttribute("id","sconnect_install_window");F.className="sconnect_install_window_cls";var I=document.createElement("div");var D=document.createElement("table");D.style.backgroundImage="url(http://www.sconnect.com/install/images/header_bg.gif)";D.className="header";if(BrowserDetect.browser=="Explorer"){D.style.width=A.width+"px"}else{D.style.width=A.width+6+"px"}var E=document.createElement("tbody");var H=document.createElement("tr");var C=document.createElement("td");C.className="caption";C.innerHTML=A.title;var B=document.createElement("td");B.className="close";var G=document.createElement("div");var J=document.createElement("img");J.src="http://www.sconnect.com/install/images/w_close.gif";J.style.cursor="pointer";J.style.padding="0pt 3px 0pt 0pt";J.onclick=SConnect._destroyWindow;G.appendChild(J);B.appendChild(G);H.appendChild(C);H.appendChild(B);E.appendChild(H);D.appendChild(E);I.appendChild(D);F.appendChild(I);return F};SConnect._createInstallDialog=function(H){var A=SConnect._createWindow({title:"SConnect",width:400,height:"180px"});var D=document.createElement("div");D.className="content";D.style.width="400px";D.style.height="180px";D.style.background="#FFFFFF url(http://www.sconnect.com/install/images/bg.png) repeat-x";var F=document.createElement("div");F.id="sconnect_install_uppermessage";if(SConnect.updateRequired){F.innerHTML="<p>To use this web application you need to update SConnect by clicking the button below.</p>"}else{F.innerHTML="<p>To use this web application you need to install SConnect by clicking the button below.</p>"}var E=document.createElement("div");E.id="sconnect_install_downloadarea";var G=document.createElement("img");if(SConnect.updateRequired){G.src="http://www.sconnect.com/install/images/update.png"}else{G.src="http://www.sconnect.com/install/images/install.png"}G.onclick=SConnect._doInstall;E.appendChild(G);var B=document.createElement("div");B.id="sconnect_install_licensearea";if(SConnect.updateRequired){B.innerHTML='<p>By clicking on <b>"Update"</b> you accept the <a onclick="window.open(\'http://www.sconnect.com/install/license.htm\');" href="javascript:void(0);">SConnect License agreement</a></p>'}else{B.innerHTML='<p>By clicking on <b>"Install"</b> you accept the <a onclick="window.open(\'http://www.sconnect.com/install/license.htm\');" href="javascript:void(0);">SConnect License agreement</a></p>'}var C=document.createElement("div");C.id="sconnect_install_descriptionarea";C.innerHTML="<p>SConnect is a cross-platform, cross-browser extension providing Smart Card functionality and enhanced security to web applications.</p>";D.appendChild(document.createElement("br"));D.appendChild(F);D.appendChild(document.createElement("br"));D.appendChild(E);D.appendChild(document.createElement("br"));D.appendChild(B);D.appendChild(document.createElement("hr"));D.appendChild(C);A.appendChild(D);document.body.appendChild(A)};SConnect._createFirefoxHelpDialog=function(){var A=SConnect._createWindow({title:"Note the yellow bar",width:400,height:"240px"});var C=document.createElement("div");C.className="content";C.style.width="400px";C.style.height="240px";C.style.background="#FFFFFF url(http://www.sconnect.com/install/images/bg.png) repeat-x";var F=document.createElement("div");F.id="sconnect_install_yellowbararea";var E=document.createElement("img");E.src="http://www.sconnect.com/install/images/ffyellowbar.png";F.appendChild(E);var B=document.createElement("div");B.id="sconnect_install_instructionsarea";var H="<ul><li>Click on 'Edit options'.</li><li>Allow this web site.</li>";if(SConnect.updateRequired){H+="<li>Press the 'Update' button below.</li></ul>"}else{H+="<li>Press the 'Install' button below.</li></ul>"}B.innerHTML=H;var D=document.createElement("div");D.id="sconnect_install_downloadarea";var G=document.createElement("img");if(SConnect.updateRequired){G.src="http://www.sconnect.com/install/images/update.png"}else{G.src="http://www.sconnect.com/install/images/install.png"}G.onclick=SConnect._doInstall;D.appendChild(G);C.appendChild(document.createElement("br"));C.appendChild(F);C.appendChild(B);C.appendChild(document.createElement("br"));C.appendChild(D);A.appendChild(C);document.body.appendChild(A)};SConnect._createNotSupportedDialog=function(){var A=SConnect._createWindow({title:"Browser not supported",width:400,height:"250px"});var C=document.createElement("div");C.className="content";C.style.width="400px";C.style.height="250px";C.style.background="#FFFFFF url(http://www.sconnect.com/install/images/bg.png) repeat-x";var B=document.createElement("div");B.id="sconnect_install_instructionsarea";B.innerHTML="<p>SConnect is currently not supported for this browser.</p>Supported browsers are:<ul><li>Internet Explorer 5.5,6.0,7.0</li><li>Mozilla Firefox 1.5+,2.0+</li><li>Flock</li><li>Netscape</li></ul>Supported platforms are:<ul><li>Windows 2000, XP and Vista</li><li>Linux</li><li>Mac OS X</li></u>";C.appendChild(document.createElement("br"));C.appendChild(B);A.appendChild(C);document.body.appendChild(A)};SConnect.TriggerInstall=function(){SConnect._createStyleSheet("#sconnect_install_overlay {display:block;background-color:#CCCCCC;position:absolute;margin:auto;top:0;left:0;z-index:40000;}","sconnect_css_overlay");SConnect._createStyleSheet("#sconnect_install_window {margin:0;padding:0;left:20px;top:20px;font-size:1px;position:absolute;overflow:visible;z-index:40002;}","sconnect_css_window");SConnect._createStyleSheet("#sconnect_install_window .content {width:auto;margin:0;padding:0;}","sconnect_css_window_content");SConnect._createStyleSheet("#sconnect_install_window p {margin:0;padding:0;}","sconnect_css_window_p");SConnect._createStyleSheet("#sconnect_install_window .content p{margin:10;}","sconnect_css_window_content_p");SConnect._createStyleSheet(".sconnect_install_window_cls .content {background-color:#fff;border:3px solid #ccc;border-top:none;}","sconnect_css_window_cls_content");SConnect._createStyleSheet(".sconnect_install_window_cls .header {border-bottom: 1px solid #aaa;border-top:1px solid #999;border-left:3px solid #ccc;border-right:3px solid #ccc;margin:0;height:22px;font-size:12px;padding:3px 0;color: #333;}","sconnect_css_window_header");SConnect._createStyleSheet(".sconnect_install_window_cls .caption {font-family:Arial, Helvetica, sans-serif;font-size:12px;text-align:left;font-weight:bold;white-space:nowrap;padding-right:20px;}","sconnect_css_window_caption");SConnect._createStyleSheet(".sconnect_install_window_cls .close {text-align:right;}","sconnect_css_window_close");SConnect._createStyleSheet(".sconnect_install_window_cls .close img {cursor:pointer;padding:0 3px 0 0;}","sconnect_css_window_close_img");SConnect._createStyleSheet("#sconnect_install_uppermessage p{font-weight:bold;font-family:Arial, Helvetica, sans-serif;font-size:12px;text-align:center;}","sconnect_css_window_uppermessage");SConnect._createStyleSheet("#sconnect_install_descriptionarea p{font-size:10px;font-family:Arial, Helvetica, sans-serif;margin-left:10px;margin-right:10px;}","sconnect_css_window_descriptionarea");SConnect._createStyleSheet("#sconnect_install_instructionsarea {font-size:12px;font-family:Arial, Helvetica, sans-serif;margin-left:10px;margin-right:10px;}","sconnect_css_window_instructionarea");SConnect._createStyleSheet("#sconnect_install_licensearea p{font-size:10px;font-family:Arial, Helvetica, sans-serif;text-align:center;}","sconnect_css_window_licensearea");SConnect._createStyleSheet("#sconnect_install_downloadarea {text-align:center;}","sconnect_css_window_downloadarea");if((BrowserDetect.browser=="Explorer")||(BrowserDetect.browser=="Firefox")){SConnect._createInstallDialog(SConnect.updateRequired)}else{SConnect._createNotSupportedDialog()}};SConnect.Inherits=function(B,C){function A(){}A.prototype=C.prototype;B.prototype=new A();B.prototype.constructor=B;B.superclass=C;B.superproto=C.prototype};SConnect.Exception=function(A){this._message=A||"";this._fromCard=false};SConnect.Exception.prototype={getMessage:function(){return this._message},fromCard:function(){return this._fromCard},getFunctionName:function(A){var B=A.toString().match(/function (\w*)/)[1];if((B===null)||(B.length===0)){B="anonymous"}return B},parseErrorStack:function(D){var A=[];var B;if(!D||!D.stack){return A}var F=D.stack.split("\n");for(var C=0;C<(F.length-1);C++){var E=F[C];B=E.match(/^(\w*)/)[1];if(!B){B="anonymous"}A[A.length]=B}while(A.length&&A[A.length-1]=="anonymous"){A.length=A.length-1}return A},getStackTrace:function(){var B="";if(typeof (arguments.caller)!="undefined"){for(var C=arguments.caller;C!==null;C=C.caller){B+="> "+this.getFunctionName(C.callee)+"\n";if(C.caller==C){B+="*";break}}}else{var D;try{foo.bar}catch(D){var A=this.parseErrorStack(D);for(var E=1;E<A.length;E++){B+="> "+A[E]+"\n"}}}return B}};SConnect.PCSCException=function(B,A){this._errorCode=B;SConnect.PCSCException.superclass.call(this,A)};SConnect.Inherits(SConnect.PCSCException,SConnect.Exception);$PCSCExProto=SConnect.PCSCException.prototype;$PCSCExProto.getErrorCode=function(){return this._errorCode};$PCSCExProto.getErrorMessage=function(){var A=null;switch(this._errorCode){case SCardResponseCode.Cancelled:A="Cancelled";break;case SCardResponseCode.InsufficientBuffer:A="InsufficientBuffer";break;case SCardResponseCode.InvalidHandle:A="InvalidHandle";break;case SCardResponseCode.InvalidParameter:A="InvalidParameter";break;case SCardResponseCode.InvalidValue:A="InvalidValue";break;case SCardResponseCode.NoMemory:A="NoMemory";break;case SCardResponseCode.NoService:A="NoService";break;case SCardResponseCode.NoSmartCard:A="NoSmartCard";break;case SCardResponseCode.NotReady:A="NotReady";break;case SCardResponseCode.NotTransacted:A="NotTransacted";break;case SCardResponseCode.ProtoMismatch:A="ProtoMismatch";break;case SCardResponseCode.ReaderUnavailable:A="ReaderUnavailable";break;case SCardResponseCode.RemovedCard:A="RemovedCard";break;case SCardResponseCode.ResetCard:A="ResetCard";break;case SCardResponseCode.ServiceStopped:A="ServiceStopped";break;case SCardResponseCode.SharingViolation:A="SharingViolation";break;case SCardResponseCode.SystemCancelled:A="SystemCancelled";break;case SCardResponseCode.Timeout:A="Timeout";break;case SCardResponseCode.UnknownCard:A="UnknownCard";break;case SCardResponseCode.UnknownReader:A="UnknownReader";break;case SCardResponseCode.UnpoweredCard:A="UnpoweredCard";break;case SCardResponseCode.UnresponsiveCard:A="UnresponsiveCard";break;case SCardResponseCode.UnsupportedCard:A="UnsupportedCard";break;case SCardResponseCode.NoReadersAvailable:A="NoReadersAvailable";break}return A};SConnect._instanceID=0;SConnect.PCSC=function(A){this._eContext=false;this._isDisposed=false;this._connectedReader=null;this._smartCardComm=null;this._inTransaction=false;this._pollingInterval=50;this._poll=0;this._activeProtocol=0;this._statusChangeHandlingActive=false;this._transactionCounter=0;this._irHandler=null;if(BrowserDetect.browser=="Explorer"){if(new SConnect.Installer.ie().isSupported()){try{if(!window.sconnect){window.sconnect=new ActiveXObject("SConnectLib.SConnect")}this._smartCardComm=window.sconnect.Create("sconnect.pcsc")}catch(B){throw new SConnect.Exception("BrowserExtensionNotInstalled")}}}else{if(BrowserDetect.browser=="Firefox"){if(new SConnect.Installer.firefox().isSupported()){try{if(!window.sconnect){window.sconnect=new nsSConnect()}this._smartCardComm=window.sconnect.Create("sconnect.pcsc")}catch(B){throw new SConnect.Exception("BrowserExtensionNotInstalled")}}}else{if(BrowserDetect.browser=="Safari"){if(new SConnect.Installer.safari().isSupported()){var C=document.createElement("object");C.style.display="none";C.width=0;C.height=0;C.id="scom_"+SConnect._instanceID;C.type="application/x-sconnectwebkitplugin";document.documentElement.appendChild(C);C.innerHTML+="";SConnect._instanceID+=1;this._smartCardComm=C}}else{throw new SConnect.Exception("BrowserNotSupported")}}}if(typeof (A)=="undefined"){A=true}if(A){this.establishContext()}};SConnect.PCSC.prototype={registerStatusChangeListener:function(A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._statusChangeHandlingActive===true){return }if(BrowserDetect.browser=="Safari"){this._irhandler=A;this._smartCardComm.RegisterScriptObject(this);this._smartCardComm.RegisterCardStatusChangeEvent()}else{if(BrowserDetect.browser=="Firefox"){this._smartCardComm.oninsertionremoval=A;this._smartCardComm.RegisterCardStatusChangeEvent()}else{this._smartCardComm.RegisterCardStatusChangeEvent(A)}}this._statusChangeHandlingActive=true},insertionRemovalHandler:function(A,B){this._irhandler(A,B)},unregisterStatusChangeListener:function(){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._statusChangeHandlingActive===false){return }this._smartCardComm.UnregisterCardStatusChangeEvent();this._statusChangeHandlingActive=false},establishContext:function(B){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._eContext){throw new SConnect.Exception("InvalidOperation")}if(typeof (B)=="undefined"){B=SCardScope.User}var A=this._smartCardComm.PCSCSCardEstablishContext(B);if(A!==0){throw new SConnect.PCSCException(A)}this._eContext=true;return true},releaseContext:function(){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(!this._eContext){throw new SConnect.Exception("InvalidOperation")}var A=this._smartCardComm.PCSCSCardReleaseContext();if(A!==0){throw new SConnect.PCSCException(A)}this._eContext=false},dispose:function(){if(!this._isDisposed){var A=null;if(this._inTransaction){A=this._smartCardComm.PCSCSCardEndTransaction(SCardDisposition.LeaveCard);this._inTransaction=false}if(this._connectedReader!==null){A=this._smartCardComm.PCSCSCardDisconnect(SCardDisposition.LeaveCard);this._connectedReader=null}this.unregisterStatusChangeListener();this.releaseContext();this._activeProtocol=0;this._isDisposed=true}},beginTransaction:function(){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(this._transactionCounter===0){var A=this._smartCardComm.PCSCSCardBeginTransaction();if(A!==0){throw new SConnect.PCSCException(A)}}this._transactionCounter++;this._inTransaction=true;return this._transactionCounter},connect:function(D,B,C){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader!==null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(typeof (B)=="undefined"){B=SCardAccessMode.Shared}if(typeof (C)=="undefined"){C=SCardProtocolIdentifiers.T0}var A=this._smartCardComm.PCSCSCardConnect(D,B,C);this._activeProtocol=this._smartCardComm.PCSCSCardGetActiveProtocol();if(A===0){this._connectedReader=D;return true}if(A==SCardResponseCode.RemovedCard){return false}throw new SConnect.PCSCException(A)},disconnect:function(A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(typeof (A)=="undefined"){A=SCardDisposition.LeaveCard}var B=this._smartCardComm.PCSCSCardDisconnect(A);this._activeProtocol=0;this._connectedReader=null;this._inTransaction=false;if(B!==0){throw new SConnect.PCSCException(B)}},endTransaction:function(C,A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if((this._connectedReader===null)||(this._inTransaction===false)){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(C!=this._transactionCounter){throw new SConnect.Exception("InvalidOperation")}if(typeof (A)=="undefined"){A=SCardDisposition.LeaveCard}this._transactionCounter--;if(this._transactionCounter===0){var B=this._smartCardComm.PCSCSCardEndTransaction(A);if(B!==0){throw new SConnect.PCSCException(B)}this._inTransaction=false}},reconnect:function(C,D,A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(A==SCardDisposition.EjectCard){throw new SConnect.Exception("InvalidDispositionMode")}if(typeof (C)=="undefined"){C=SCardAccessMode.Shared}if(typeof (D)=="undefined"){D=SCardProtocolIdentifiers.T0}if(typeof (A)=="undefined"){A=SCardDisposition.LeaveCard}this._activeProtocol=0;var B=this._smartCardComm.PCSCSCardReconnect(C,D,A,this._activeProtocol);if(B===0){return true}if(B==SCardResponseCode.RemovedCard){return false}throw new SConnect.PCSCException(B)},cardStatus:function(){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}var B=this._smartCardComm.PCSCSCardStatus();if(B!==0){throw new SConnect.PCSCException(B)}var A=new SConnect.SCardStatus();A.Protocol=this._smartCardComm.PCSCSCardGetActiveProtocol();A.State=this._smartCardComm.PCSCSCardGetCardState();A.ATR=this._smartCardComm.PCSCSCardGetCardATR();return A},transmit:function(A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length!=1){throw new SConnect.Exception("InsufficientArguments")}var D=this._smartCardComm.PCSCSCardTransmit(0,A);if(D===0){D=this._smartCardComm.PCSCSCardTransmitResult();var B={};var C="";if(D.length>4){C=D.substr(0,(D.length-4))}B.dataOut=C;B.statusWord=D.substr(D.length-4,4);B.errorCode=0;return B}throw new SConnect.PCSCException(D)},async_transmit:function(A,B){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(B!==null&&B!="undefined"){this.handleReadyState(this._smartCardComm,B)}this._smartCardComm.PCSCSCardAsynTransmit(0,A)},setPollingInterval:function(A){if((typeof A=="number")&&isFinite(A)){this._pollingInterval=A}},handleReadyState:function(D,E){var A=this;var B=E.timeout;try{if(B!==undefined){this._timeOut=window.setTimeout(function(){A.abort(D,E,true)},B)}this._poll=window.setInterval(function(){if(BrowserDetect.browser=="Safari"){if(D){D.readyState=D.GetReadyState()}}if(D&&D.readyState==4){window.clearInterval(A._poll);if(B){}A.handleResponse(D,E)}},this._pollingInterval)}catch(C){window.clearInterval(A._poll);A.handleResponse(D,E)}},handleResponse:function(E,F){var B={};var D=null;D=E.PCSCSCardGetResponseText();var A=D.indexOf("ERROR-");if(A==-1){var C="";if(D.length>4){C=D.substr(0,(D.length-4))}B.dataOut=C;B.statusWord=D.substr(D.length-4,4);B.errorCode=0;if(F.argument){B.argument=F.argument}if(F.success){if(!F.scope){F.success(B)}else{F.success.apply(F.scope,[B])}}}else{D=D.substring(A);B.dataOut="";B.statusWord="";B.errorCode=D;if(F.argument){B.argument=F.argument}if(F.failure){if(!F.scope){F.failure(B)}else{F.failure.apply(F.scope,[B])}}}},exchangeAPDU:function(A){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length!=1){throw new SConnect.Exception("InsufficientArguments")}var H=this.beginTransaction();try{var D=this.transmit(A);var E=D.dataOut;var C=D.statusWord.substr(0,2);var B=D.statusWord.substr(2,2);while(C=="61"||C=="91"){var G=null;if(C=="91"){G="A0"}else{G="00"}G+="C00000"+B;D=this.transmit(G);E+=D.dataOut;C=D.statusWord.substr(0,2);B=D.statusWord.substr(2,2)}var F={};F.statusWord=C+B;F.dataOut=E}finally{this.endTransaction(H,SCardDisposition.LeaveCard)}return F},listReaders:function(B){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(!this._eContext){throw new SConnect.Exception("InvalidOperation")}if(arguments.length!=1){throw new SConnect.Exception("InsufficientArguments")}if(B===true){B=1}else{if(B===false){B=0}}var A=this._smartCardComm.PCSCSCardListReaders(B);if(A===0){A=this._smartCardComm.PCSCSCardGetReaderList()}else{throw new SConnect.PCSCException(A)}A=A.split("#");A=A.splice(0,A.length-1);return A},inTransaction:function(){return this._inTransaction},isConnected:function(){return(this._connectedReader!==null)},connectedReader:function(){return this._connectedReader},setOnReadyStateChangeHandler:function(A){this._smartCardComm.onreadystatechange=A},getExtensionVersion:function(){var B=window.sconnect.Version();var A=SConnect.TypeUtils.hexStringToByteArray(B);var C=new SConnect.ExtensionVersion();C.Major=A[0];C.Minor=A[1];C.Build=A[2];C.Revision=A[3];return C},cardControl:function(D,A,B){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}var C=this._smartCardComm.PCSCSCardControl(D,B,A);if(C===0){return this._smartCardComm.PCSCSCardTransmitResult()}throw new SConnect.PCSCException(C)}}

var MARSHALLER_TYPE_IN_VOID=0;var MARSHALLER_TYPE_IN_BOOL=1;var MARSHALLER_TYPE_IN_S1=2;var MARSHALLER_TYPE_IN_U1=3;var MARSHALLER_TYPE_IN_CHAR=4;var MARSHALLER_TYPE_IN_S2=5;var MARSHALLER_TYPE_IN_U2=6;var MARSHALLER_TYPE_IN_S4=7;var MARSHALLER_TYPE_IN_U4=8;var MARSHALLER_TYPE_IN_S8=9;var MARSHALLER_TYPE_IN_U8=10;var MARSHALLER_TYPE_IN_STRING=11;var MARSHALLER_TYPE_IN_BOOLARRAY=21;var MARSHALLER_TYPE_IN_S1ARRAY=22;var MARSHALLER_TYPE_IN_U1ARRAY=23;var MARSHALLER_TYPE_IN_CHARARRAY=24;var MARSHALLER_TYPE_IN_S2ARRAY=25;var MARSHALLER_TYPE_IN_U2ARRAY=26;var MARSHALLER_TYPE_IN_S4ARRAY=27;var MARSHALLER_TYPE_IN_U4ARRAY=28;var MARSHALLER_TYPE_IN_S8ARRAY=29;var MARSHALLER_TYPE_IN_U8ARRAY=30;var MARSHALLER_TYPE_IN_STRINGARRAY=31;var MARSHALLER_TYPE_IN_MEMORYSTREAM=40;var MARSHALLER_TYPE_RET_VOID=MARSHALLER_TYPE_IN_VOID;var MARSHALLER_TYPE_RET_BOOL=MARSHALLER_TYPE_IN_BOOL;var MARSHALLER_TYPE_RET_S1=MARSHALLER_TYPE_IN_S1;var MARSHALLER_TYPE_RET_U1=MARSHALLER_TYPE_IN_U1;var MARSHALLER_TYPE_RET_CHAR=MARSHALLER_TYPE_IN_CHAR;var MARSHALLER_TYPE_RET_S2=MARSHALLER_TYPE_IN_S2;var MARSHALLER_TYPE_RET_U2=MARSHALLER_TYPE_IN_U2;var MARSHALLER_TYPE_RET_S4=MARSHALLER_TYPE_IN_S4;var MARSHALLER_TYPE_RET_U4=MARSHALLER_TYPE_IN_U4;var MARSHALLER_TYPE_RET_S8=MARSHALLER_TYPE_IN_S8;var MARSHALLER_TYPE_RET_U8=MARSHALLER_TYPE_IN_U8;var MARSHALLER_TYPE_RET_STRING=MARSHALLER_TYPE_IN_STRING;var MARSHALLER_TYPE_RET_BOOLARRAY=MARSHALLER_TYPE_IN_BOOLARRAY;var MARSHALLER_TYPE_RET_S1ARRAY=MARSHALLER_TYPE_IN_S1ARRAY;var MARSHALLER_TYPE_RET_U1ARRAY=MARSHALLER_TYPE_IN_U1ARRAY;var MARSHALLER_TYPE_RET_CHARARRAY=MARSHALLER_TYPE_IN_CHARARRAY;var MARSHALLER_TYPE_RET_S2ARRAY=MARSHALLER_TYPE_IN_S2ARRAY;var MARSHALLER_TYPE_RET_U2ARRAY=MARSHALLER_TYPE_IN_U2ARRAY;var MARSHALLER_TYPE_RET_S4ARRAY=MARSHALLER_TYPE_IN_S4ARRAY;var MARSHALLER_TYPE_RET_U4ARRAY=MARSHALLER_TYPE_IN_U4ARRAY;var MARSHALLER_TYPE_RET_S8ARRAY=MARSHALLER_TYPE_IN_S8ARRAY;var MARSHALLER_TYPE_RET_U8ARRAY=MARSHALLER_TYPE_IN_U8ARRAY;var MARSHALLER_TYPE_RET_STRINGARRAY=MARSHALLER_TYPE_IN_STRINGARRAY;var MARSHALLER_TYPE_RET_MEMORYSTREAM=MARSHALLER_TYPE_IN_MEMORYSTREAM;function HiveCodes(){}HiveCodes.NAMESPACE_SYSTEM=13786396;HiveCodes.NAMESPACE_SYSTEM_IO=14018267;HiveCodes.NAMESPACE_SCHLUMBERGER_OS32=11520178;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_REMOTING_CHANNELS=34926;HiveCodes.NAMESPACE_NETCARD_FILESYSTEM=10595385;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_REMOTING=15416793;HiveCodes.NAMESPACE_SYSTEM_SECURITY_CRYPTOGRAPHY=11334971;HiveCodes.NAMESPACE_SYSTEM_COLLECTIONS=12951568;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_REMOTING_CONTEXTS=2050452;HiveCodes.NAMESPACE_SYSTEM_SECURITY=9847109;HiveCodes.NAMESPACE_SYSTEM_REFLECTION=554255;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_SERIALIZATION=9255741;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_REMOTING_MESSAGING=14596416;HiveCodes.NAMESPACE_SYSTEM_DIAGNOSTICS=9935199;HiveCodes.NAMESPACE_SYSTEM_RUNTIME_COMPILERSERVICES=16137745;HiveCodes.NAMESPACE_SYSTEM_TEXT=7350102;HiveCodes.NAMESPACE_SMARTCARD=16117695;HiveCodes.TYPE_SYSTEM_VOID=52865;HiveCodes.TYPE_SYSTEM_INT32=25024;HiveCodes.TYPE_SYSTEM_INT32_ARRAY=25025;HiveCodes.TYPE_SYSTEM_BOOLEAN=8743;HiveCodes.TYPE_SYSTEM_BOOLEAN_ARRAY=8744;HiveCodes.TYPE_SYSTEM_SBYTE=30334;HiveCodes.TYPE_SYSTEM_SBYTE_ARRAY=30335;HiveCodes.TYPE_SYSTEM_UINT16=55691;HiveCodes.TYPE_SYSTEM_UINT16_ARRAY=55692;HiveCodes.TYPE_SYSTEM_UINT32=38375;HiveCodes.TYPE_SYSTEM_UINT32_ARRAY=38376;HiveCodes.TYPE_SYSTEM_BYTE=17826;HiveCodes.TYPE_SYSTEM_BYTE_ARRAY=17827;HiveCodes.TYPE_SYSTEM_CHAR=38286;HiveCodes.TYPE_SYSTEM_CHAR_ARRAY=38287;HiveCodes.TYPE_SYSTEM_INT16=48185;HiveCodes.TYPE_SYSTEM_INT16_ARRAY=48186;HiveCodes.TYPE_SYSTEM_STRING=4391;HiveCodes.TYPE_SYSTEM_STRING_ARRAY=4392;HiveCodes.TYPE_SYSTEM_INT64=57083;HiveCodes.TYPE_SYSTEM_INT64_ARRAY=57084;HiveCodes.TYPE_SYSTEM_UINT64=29103;HiveCodes.TYPE_SYSTEM_UINT64_ARRAY=29104;HiveCodes.TYPE_SYSTEM_IO_MEMORYSTREAM=65239;HiveCodes.TYPE_SYSTEM_EXCEPTION=54448;HiveCodes.TYPE_SYSTEM_SYSTEMEXCEPTION=10412;HiveCodes.TYPE_SYSTEM_OUTOFMEMORYEXCEPTION=57678;HiveCodes.TYPE_SYSTEM_ARGUMENTEXCEPTION=43916;HiveCodes.TYPE_SYSTEM_ARGUMENTNULLEXCEPTION=8504;HiveCodes.TYPE_SYSTEM_NULLREFERENCEEXCEPTION=50616;HiveCodes.TYPE_SYSTEM_ARGUMENTOUTOFRANGEEXCEPTION=27409;HiveCodes.TYPE_SYSTEM_NOTSUPPORTEDEXCEPTION=43636;HiveCodes.TYPE_SYSTEM_INVALIDCASTEXCEPTION=53839;HiveCodes.TYPE_SYSTEM_INVALIDOPERATIONEXCEPTION=64180;HiveCodes.TYPE_SYSTEM_NOTIMPLEMENTEDEXCEPTION=15589;HiveCodes.TYPE_SYSTEM_OBJECTDISPOSEDEXCEPTION=4012;HiveCodes.TYPE_SYSTEM_UNAUTHORIZEDACCESSEXCEPTION=18071;HiveCodes.TYPE_SYSTEM_INDEXOUTOFRANGEEXCEPTION=48925;HiveCodes.TYPE_SYSTEM_FORMATEXCEPTION=62399;HiveCodes.TYPE_SYSTEM_ARITHMETICEXCEPTION=26243;HiveCodes.TYPE_SYSTEM_OVERFLOWEXCEPTION=8352;HiveCodes.TYPE_SYSTEM_BADIMAGEFORMATEXCEPTION=21258;HiveCodes.TYPE_SYSTEM_APPLICATIONEXCEPTION=45546;HiveCodes.TYPE_SYSTEM_ARRAYTYPEMISMATCHEXCEPTION=16264;HiveCodes.TYPE_SYSTEM_DIVIDEBYZEROEXCEPTION=57295;HiveCodes.TYPE_SYSTEM_MEMBERACCESSEXCEPTION=62963;HiveCodes.TYPE_SYSTEM_MISSINGMEMBEREXCEPTION=8379;HiveCodes.TYPE_SYSTEM_MISSINGFIELDEXCEPTION=29542;HiveCodes.TYPE_SYSTEM_MISSINGMETHODEXCEPTION=36955;HiveCodes.TYPE_SYSTEM_RANKEXCEPTION=45742;HiveCodes.TYPE_SYSTEM_STACKOVERFLOWEXCEPTION=2116;HiveCodes.TYPE_SYSTEM_TYPELOADEXCEPTION=1166;HiveCodes.TYPE_SYSTEM_IO_IOEXCEPTION=15294;HiveCodes.TYPE_SYSTEM_IO_DIRECTORYNOTFOUNDEXCEPTION=38746;HiveCodes.TYPE_SYSTEM_IO_FILENOTFOUNDEXCEPTION=2027;HiveCodes.TYPE_SYSTEM_RUNTIME_REMOTING_REMOTINGEXCEPTION=54570;HiveCodes.TYPE_SYSTEM_SECURITY_CRYPTOGRAPHY_CRYPTOGRAPHICEXCEPTION=36843;HiveCodes.TYPE_SMARTCARD_CONTENTMANAGER=45452;HiveCodes.METHOD_SMARTCARD_CONTENTMANAGER_GETASSOCIATEDPORT=30230;SConnect.MarshallerException=function(A){this._exceptionNamespace="";this._exceptionClass="";this._fromCard=false;SConnect.MarshallerException.superclass.call(this,A)};SConnect.Inherits(SConnect.MarshallerException,SConnect.Exception);$MarshalerExProto=SConnect.MarshallerException.prototype;$MarshalerExProto.setExceptionClass=function(A){this._exceptionClass=A};$MarshalerExProto.getExceptionClass=function(){return this._exceptionClass};$MarshalerExProto.setExceptionNamespace=function(A){this._exceptionNamespace=A};$MarshalerExProto.getExceptionNamespace=function(){return this._exceptionNamespace};$MarshalerExProto.getFullQualifiedException=function(){return this._exceptionNamespace+"."+this._exceptionClass};SConnect.Marshaller=function(E,B,D,A,C){this.scardComm=null;this.readerName=E;this.portNum=B;this.serviceName=D;this.nameSpaceHiveCode=A;this.typeHiveCode=C;this.processInputStream=null;this.processOutputStream=null;this.callback=null;this.callbackFinished=true;this.discoverCard()};SConnect.Marshaller.CARDMANAGER_SERVICE_PORT=1;SConnect.Marshaller.CARDMANAGER_SERVICE_NAME="ContentManager";SConnect.Marshaller.APDU_TO_CARD_MAX_SIZE=255;SConnect.Marshaller.pushUByte=function(B,C){var A=(B&255);C.push(A)};SConnect.Marshaller.pushUShort=function(C,D){var B=((C&65280)>>8)&255;var A=(C&255);D.push(B);D.push(A)};SConnect.Marshaller.pushUInt=function(D,F){var E=((D&4278190080)>>24)&255;var C=((D&16711680)>>16)&255;var B=((D&65280)>>8)&255;var A=(D&255);F.push(E);F.push(C);F.push(B);F.push(A)};SConnect.Marshaller.pushULong=function(I,D){var J=((I&18374686479671624000)>>56)&255;var H=((I&71776119061217280)>>48)&255;var G=((I&280375465082880)>>40)&255;var F=((I&1095216660480)>>32)&255;var E=((I&4278190080)>>24)&255;var C=((I&16711680)>>16)&255;var B=((I&65280)>>8)&255;var A=(I&255);D.push(J);D.push(H);D.push(G);D.push(F);D.push(E);D.push(C);D.push(B);D.push(A)};SConnect.Marshaller.pushUByteArray=function(B,C){for(var A=0;A<B.length;A++){C.push(B[A])}};SConnect.Marshaller.pushUShortArray=function(A,C){for(var B=0;B<A.length;B++){SConnect.Marshaller.pushUShort(A[B],C)}};SConnect.Marshaller.pushUIntArray=function(B,C){for(var A=0;A<B.length;A++){SConnect.Marshaller.pushUInt(B[A],C)}};SConnect.Marshaller.pushString=function(B,C){var A=SConnect.TypeUtils.utf8Encode(B);SConnect.Marshaller.pushUShort(A.length,C);SConnect.Marshaller.pushUByteArray(A,C)};SConnect.Marshaller.readULong=function(E,A){var J=E[A];var I=E[A+1];var H=E[A+2];var G=E[A+3];var F=E[A+4];var D=E[A+5];var C=E[A+6];var B=E[A+7];return(J<<56|I<<48|H<<40|G<<32|F<24|D<<16|C<<8|B)};SConnect.Marshaller.readLong=function(C,B){var A=SConnect.Marshaller.readULong(C,B);return SConnect.TypeUtils.ulongToLong(A)};SConnect.Marshaller.readUInt=function(F,E){var D=F[E];var C=F[E+1];var B=F[E+2];var A=F[E+3];return(D<<24|C<<16|B<<8|A)};SConnect.Marshaller.readInt=function(C,B){var A=SConnect.Marshaller.readUInt(C,B);return SConnect.TypeUtils.uintToInt(A)};SConnect.Marshaller.readUShort=function(D,C){var B=D[C];var A=D[C+1];return(B<<8|A)};SConnect.Marshaller.readShort=function(C,B){var A=SConnect.Marshaller.readUShort(C,B);return SConnect.TypeUtils.ushortToShort(A)};SConnect.Marshaller.processException=function(C,F){var D=SConnect.Marshaller.readUInt(C,F);var A=SConnect.Marshaller.readUShort(C,F+4);var G="";var E="";switch(D){case HiveCodes.NAMESPACE_SYSTEM:G="System";break;case HiveCodes.NAMESPACE_SYSTEM_IO:G="System.IO";break;case HiveCodes.NAMESPACE_SYSTEM_RUNTIME_REMOTING:G="System.Runtime.Remoting";break;case HiveCodes.NAMESPACE_SYSTEM_SECURITY_CRYPTOGRAPHY:G="System.Security.Cryptography";break}switch(A){case HiveCodes.TYPE_SYSTEM_EXCEPTION:E="Exception";break;case HiveCodes.TYPE_SYSTEM_SYSTEMEXCEPTION:E="SystemException";break;case HiveCodes.TYPE_SYSTEM_OUTOFMEMORYEXCEPTION:E="OutOfMemoryException";break;case HiveCodes.TYPE_SYSTEM_ARGUMENTEXCEPTION:E="ArgumentException";break;case HiveCodes.TYPE_SYSTEM_ARGUMENTNULLEXCEPTION:E="ArgumentNullException";break;case HiveCodes.TYPE_SYSTEM_NULLREFERENCEEXCEPTION:E="NullReferenceException";break;case HiveCodes.TYPE_SYSTEM_ARGUMENTOUTOFRANGEEXCEPTION:E="ArgumentOutOfRangeException";break;case HiveCodes.TYPE_SYSTEM_NOTSUPPORTEDEXCEPTION:E="NotSupportedException";break;case HiveCodes.TYPE_SYSTEM_INVALIDCASTEXCEPTION:E="InvalidCastException";break;case HiveCodes.TYPE_SYSTEM_INVALIDOPERATIONEXCEPTION:E="InvalidOperationException";break;case HiveCodes.TYPE_SYSTEM_NOTIMPLEMENTEDEXCEPTION:E="NotImplementedException";break;case HiveCodes.TYPE_SYSTEM_OBJECTDISPOSEDEXCEPTION:E="ObjectDisposedException";break;case HiveCodes.TYPE_SYSTEM_UNAUTHORIZEDACCESSEXCEPTION:E="UnauthorizedAccessException";break;case HiveCodes.TYPE_SYSTEM_INDEXOUTOFRANGEEXCEPTION:E="IndexOutOfRangeException";break;case HiveCodes.TYPE_SYSTEM_FORMATEXCEPTION:E="FormatException";break;case HiveCodes.TYPE_SYSTEM_ARITHMETICEXCEPTION:E="ArithmeticException";break;case HiveCodes.TYPE_SYSTEM_OVERFLOWEXCEPTION:E="OverflowException";break;case HiveCodes.TYPE_SYSTEM_BADIMAGEFORMATEXCEPTION:E="BadImageException";break;case HiveCodes.TYPE_SYSTEM_APPLICATIONEXCEPTION:E="ApplicationException";break;case HiveCodes.TYPE_SYSTEM_ARRAYTYPEMISMATCHEXCEPTION:E="ArrayTypeMismatchException";break;case HiveCodes.TYPE_SYSTEM_DIVIDEBYZEROEXCEPTION:E="DivideByZeroException";break;case HiveCodes.TYPE_SYSTEM_MEMBERACCESSEXCEPTION:E="MemberAccessException";break;case HiveCodes.TYPE_SYSTEM_MISSINGMEMBEREXCEPTION:E="MissingMemberException";break;case HiveCodes.TYPE_SYSTEM_MISSINGFIELDEXCEPTION:E="MissingFieldException";break;case HiveCodes.TYPE_SYSTEM_MISSINGMETHODEXCEPTION:E="MissingMethodException";break;case HiveCodes.TYPE_SYSTEM_RANKEXCEPTION:E="RankException";break;case HiveCodes.TYPE_SYSTEM_STACKOVERFLOWEXCEPTION:E="StackOverflowException";break;case HiveCodes.TYPE_SYSTEM_TYPELOADEXCEPTION:E="TypeLoadException";break;case HiveCodes.TYPE_SYSTEM_IO_IOEXCEPTION:E="IOException";break;case HiveCodes.TYPE_SYSTEM_IO_DIRECTORYNOTFOUNDEXCEPTION:E="DirectoryNotFoundException";break;case HiveCodes.TYPE_SYSTEM_IO_FILENOTFOUNDEXCEPTION:E="FileNotFoundException";break;case HiveCodes.TYPE_SYSTEM_RUNTIME_REMOTING_REMOTINGEXCEPTION:E="RemotingException";break;case HiveCodes.TYPE_SYSTEM_SECURITY_CRYPTOGRAPHY_CRYPTOGRAPHICEXCEPTION:E="CryptographicException";break}var I=null;if(C.length>(F+6)){var B=SConnect.Marshaller.readUShort(C,F+6);if(B>0){I=SConnect.TypeUtils.utf8Decode(C,F+8,B)}}var H=new SConnect.MarshallerException(I);H.setExceptionClass(E);H.setExceptionNamespace(G);H._fromCard=true;throw H};SConnect.Marshaller.checkForException=function(C,D,B){var A=C[0];if(A==0){if((SConnect.Marshaller.readUInt(C,0)!=D)||(SConnect.Marshaller.readUShort(C,4)!=B)){SConnect.Marshaller.processException(C,0)}return(4+2)}if(A==255){SConnect.Marshaller.processException(C,1)}return 1};SConnect.Marshaller.IsGemaltoNet=function(G){var C=[128,194,0,0,28,216,0,1,111,0,245,239,191,177,140,221,194,0,14,67,111,110,116,101,110,116,77,97,110,97,103,101,114];var F=new SConnect.PCSC();try{var B=F.connect(G,SCardAccessMode.Shared,SCardProtocolIdentifiers.T0);if(B==true){var A=F.transmit(SConnect.TypeUtils.byteArrayToHexString(C));var D=SConnect.TypeUtils.hexStringToByteArray(A.statusWord);if(D[0]==97&&D[1]>16){F.dispose();return true}}F.dispose()}catch(E){F.dispose();return false}return false};SConnect.Marshaller.IsServicePresent=function(O,J,G,H,B){var E=[];E.push(216);SConnect.Marshaller.pushUShort(SConnect.Marshaller.CARDMANAGER_SERVICE_PORT,E);E.push(111);SConnect.Marshaller.pushUInt(HiveCodes.NAMESPACE_SMARTCARD,E);SConnect.Marshaller.pushUShort(HiveCodes.TYPE_SMARTCARD_CONTENTMANAGER,E);SConnect.Marshaller.pushUShort(HiveCodes.METHOD_SMARTCARD_CONTENTMANAGER_GETASSOCIATEDPORT,E);var L=SConnect.TypeUtils.utf8Encode(SConnect.Marshaller.CARDMANAGER_SERVICE_NAME);SConnect.Marshaller.pushUShort(L.length,E);SConnect.Marshaller.pushUByteArray(L,E);var M=SConnect.TypeUtils.utf8Encode(J);SConnect.Marshaller.pushUInt(G,E);SConnect.Marshaller.pushUShort(H,E);SConnect.Marshaller.pushUShort(M.length,E);SConnect.Marshaller.pushUByteArray(M,E);var D=[];D[0]=128;D[1]=194;D[2]=0;D[3]=0;SConnect.Marshaller.pushUByte(E.length,D);SConnect.Marshaller.pushUByteArray(E,D);try{var C=new SConnect.PCSC();var K=C.connect(O,SCardAccessMode.Shared,SCardProtocolIdentifiers.T0);if(K==true){var N=C.exchangeAPDU(SConnect.TypeUtils.byteArrayToHexString(D));var A=SConnect.TypeUtils.hexStringToByteArray(N.dataOut);var F=0;if(A[0]==0){if((SConnect.Marshaller.readUInt(A,0)==HiveCodes.NAMESPACE_SYSTEM)&&(SConnect.Marshaller.readUShort(A,4)==HiveCodes.TYPE_SYSTEM_INT32)){F=SConnect.Marshaller.readUInt(A,6);if(B==0||B==F){C.dispose();return true}}}else{if(A[0]==1){F=SConnect.Marshaller.readUInt(A,1);if(B==0||B==F){C.dispose();return true}}}}C.dispose()}catch(I){return false}return false};SConnect.Marshaller.prototype={dispose:function(){if(this.scardComm!=null){this.scardComm.dispose()}},beginTransaction:function(){return this.scardComm.beginTransaction()},endTransaction:function(A){this.scardComm.endTransaction(A,SCardDisposition.LeaveCard)},discoverCard:function(){if(this.scardComm==null){this.scardComm=new SConnect.PCSC()}if(this.readerName.toLowerCase()=="selfdiscover"){var F=this.scardComm.listReaders(1);if(F.length==0){throw new SConnect.MarshallerException("No reader with .NET Smartcard")}var C=[];C.push(216);SConnect.Marshaller.pushUShort(SConnect.Marshaller.CARDMANAGER_SERVICE_PORT,C);C.push(111);SConnect.Marshaller.pushUInt(HiveCodes.NAMESPACE_SMARTCARD,C);SConnect.Marshaller.pushUShort(HiveCodes.TYPE_SMARTCARD_CONTENTMANAGER,C);SConnect.Marshaller.pushUShort(HiveCodes.METHOD_SMARTCARD_CONTENTMANAGER_GETASSOCIATEDPORT,C);var H=SConnect.TypeUtils.utf8Encode(SConnect.Marshaller.CARDMANAGER_SERVICE_NAME);SConnect.Marshaller.pushUShort(H.length,C);SConnect.Marshaller.pushUByteArray(H,C);var I=SConnect.TypeUtils.utf8Encode(this.serviceName);SConnect.Marshaller.pushUInt(this.nameSpaceHiveCode,C);SConnect.Marshaller.pushUShort(this.typeHiveCode,C);SConnect.Marshaller.pushUShort(I.length,C);SConnect.Marshaller.pushUByteArray(I,C);var B=[];B[0]=128;B[1]=194;B[2]=0;B[3]=0;SConnect.Marshaller.pushUByte(C.length,B);SConnect.Marshaller.pushUByteArray(C,B);for(var E=0;E<F.length;E++){var G=this.scardComm.connect(F[E],SCardAccessMode.Shared,SCardProtocolIdentifiers.T0);if(G==true){var J=this.scardComm.exchangeAPDU(SConnect.TypeUtils.byteArrayToHexString(B));var A=SConnect.TypeUtils.hexStringToByteArray(J.dataOut);var D=0;if(A[0]==0){if((SConnect.Marshaller.readUInt(A,0)==HiveCodes.NAMESPACE_SYSTEM)&&(SConnect.Marshaller.readUShort(A,4)==HiveCodes.TYPE_SYSTEM_INT32)){D=SConnect.Marshaller.readUInt(A,6);if(this.portNum==0||this.portNum==D){this.portNum=D;this.readerName=F[E];return }}}else{if(A[0]==1){D=SConnect.Marshaller.readUInt(A,1);if(this.portNum==0||this.portNum==D){this.portNum=D;this.readerName=F[E];return }}}this.scardComm.disconnect(SCardDisposition.LeaveCard)}}throw new SConnect.MarshallerException("No reader with .NET Smart card with "+this.serviceName+" service")}else{if(this.scardComm.isConnected()==false){var G=this.scardComm.connect(this.readerName,SCardAccessMode.Shared,SCardProtocolIdentifiers.T0);if(G==false){throw new SConnect.MarshallerException("No reader with .NET Smart card with "+this.serviceName+" service")}}}},prepareResponse:function(I,M){var B;var L=M.dataOut;var A=SConnect.TypeUtils.hexStringToByteArray(L);if((this.processOutputStream!=null)&&(L.length>0)&&(A[0]==1)){var J=[];var G=[];for(var D=1;D<A.length;D++){J[D-1]=A[D]}J=this.processOutputStream(J);G[0]=A[0];SConnect.Marshaller.pushUByteArray(J,G);A=G}switch(I){case MARSHALLER_TYPE_RET_VOID:if(L.length>0){if(A[0]==0){SConnect.Marshaller.processException(A,0)}else{SConnect.Marshaller.processException(A,1)}}break;case MARSHALLER_TYPE_RET_BOOL:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_BOOLEAN);if(A[F]==0){B=false}else{B=true}break;case MARSHALLER_TYPE_RET_S1:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_SBYTE);B=SConnect.TypeUtils.byteToSbyte(A[F]);break;case MARSHALLER_TYPE_RET_U1:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_BYTE);B=A[F];break;case MARSHALLER_TYPE_RET_CHAR:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_CHAR);B=String.fromCharCode(SConnect.Marshaller.readUShort(A,F));break;case MARSHALLER_TYPE_RET_S2:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT16);B=SConnect.Marshaller.readShort(A,F);break;case MARSHALLER_TYPE_RET_U2:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT16);B=SConnect.Marshaller.readUShort(A,F);break;case MARSHALLER_TYPE_RET_S4:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT32);B=SConnect.Marshaller.readInt(A,F);break;case MARSHALLER_TYPE_RET_U4:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT32);B=SConnect.Marshaller.readUInt(A,F);break;case MARSHALLER_TYPE_RET_S8:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT64);B=SConnect.Marshaller.readLong(A,F);break;case MARSHALLER_TYPE_RET_U8:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT64);B=SConnect.Marshaller.readULong(A,F);break;case MARSHALLER_TYPE_RET_STRING:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_STRING);var E=SConnect.Marshaller.readUShort(A,F);if(E==65535){B=null}else{B=SConnect.TypeUtils.utf8Decode(A,F+2,E)}break;case MARSHALLER_TYPE_RET_BOOLARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_BOOLEAN_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();for(var C=0;C<E;C++){if(A[F+4+C]==0){B.push(false)}else{B.push(true)}}}break;case MARSHALLER_TYPE_RET_S1ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_SBYTE_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();for(var C=0;C<E;C++){B.push(SConnect.TypeUtils.byteToSbyte(A[F+4+C]))}}break;case MARSHALLER_TYPE_RET_U1ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_BYTE_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();for(var C=0;C<E;C++){B.push(A[F+4+C])}}break;case MARSHALLER_TYPE_RET_CHARARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_CHAR_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(String.fromCharCode(SConnect.Marshaller.readUShort(A,H)));H+=2}}break;case MARSHALLER_TYPE_RET_U2ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT16_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readUShort(A,H));H+=2}}break;case MARSHALLER_TYPE_RET_S2ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT16_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readShort(A,H));H+=2}}break;case MARSHALLER_TYPE_RET_S4ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT32_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readInt(A,H));H+=4}}break;case MARSHALLER_TYPE_RET_U4ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT32_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readUInt(A,H));H+=4}}break;case MARSHALLER_TYPE_RET_S8ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_INT64_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readLong(A,H));H+=8}}break;case MARSHALLER_TYPE_RET_U8ARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_UINT64_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){B.push(SConnect.Marshaller.readULong(A,H));H+=8}}break;case MARSHALLER_TYPE_RET_STRINGARRAY:var F=SConnect.Marshaller.checkForException(A,HiveCodes.NAMESPACE_SYSTEM,HiveCodes.TYPE_SYSTEM_STRING_ARRAY);var E=SConnect.Marshaller.readUInt(A,F);if(E==4294967295){B=null}else{B=new Array();var H=F+4;for(var C=0;C<E;C++){var K=SConnect.Marshaller.readUShort(A,H);H+=2;if(K!=65535){B.push(SConnect.TypeUtils.utf8Decode(A,H,K));H+=K}else{B.push(null)}}}break}return B},setUpAsyncCall:function(A){this.callback=A;this.callbackFinished=false},invoke:function(U){this.discoverCard();var G=SConnect.TypeUtils.utf8Encode(this.serviceName);var J=[];var T=[];J.push(216);SConnect.Marshaller.pushUShort(this.portNum,J);J.push(111);SConnect.Marshaller.pushUInt(this.nameSpaceHiveCode,J);SConnect.Marshaller.pushUShort(this.typeHiveCode,J);SConnect.Marshaller.pushUShort(arguments[1],J);SConnect.Marshaller.pushUShort(G.length,J);SConnect.Marshaller.pushUByteArray(G,J);var X=arguments[0];var P=2;for(var R=0;R<X;R++){var O=arguments[P];var S=arguments[P+1];if(typeof (S)=="undefined"){throw new SConnect.MarshallerException("Invalid number of arguments in method call")}switch(O){case MARSHALLER_TYPE_IN_BOOL:case MARSHALLER_TYPE_IN_S1:case MARSHALLER_TYPE_IN_U1:SConnect.Marshaller.pushUByte(S,T);break;case MARSHALLER_TYPE_IN_CHAR:case MARSHALLER_TYPE_IN_S2:case MARSHALLER_TYPE_IN_U2:SConnect.Marshaller.pushUShort(S,T);break;case MARSHALLER_TYPE_IN_S4:case MARSHALLER_TYPE_IN_U4:SConnect.Marshaller.pushUInt(S,T);break;case MARSHALLER_TYPE_IN_S8:case MARSHALLER_TYPE_IN_U8:SConnect.Marshaller.pushULong(S,T);break;case MARSHALLER_TYPE_IN_STRING:SConnect.Marshaller.pushString(S,T);break;case MARSHALLER_TYPE_IN_BOOLARRAY:case MARSHALLER_TYPE_IN_S1ARRAY:case MARSHALLER_TYPE_IN_U1ARRAY:case MARSHALLER_TYPE_IN_MEMORYSTREAM:if(S==null){SConnect.Marshaller.pushUInt(4294967295,T)}else{SConnect.Marshaller.pushUInt(S.length,T);SConnect.Marshaller.pushUByteArray(S,T)}break;case MARSHALLER_TYPE_IN_CHARARRAY:case MARSHALLER_TYPE_IN_S2ARRAY:case MARSHALLER_TYPE_IN_U2ARRAY:if(S==null){SConnect.Marshaller.pushUInt(4294967295,T)}else{SConnect.Marshaller.pushUInt(S.length,T);SConnect.Marshaller.pushUShortArray(S,T)}break;case MARSHALLER_TYPE_IN_S4ARRAY:case MARSHALLER_TYPE_IN_U4ARRAY:if(S==null){SConnect.Marshaller.pushUInt(4294967295,T)}else{SConnect.Marshaller.pushUInt(S.length,T);SConnect.Marshaller.pushUIntArray(S,T)}break;case MARSHALLER_TYPE_IN_STRINGARRAY:if(S==null){SConnect.Marshaller.pushUInt(4294967295,T)}else{SConnect.Marshaller.pushUInt(S.length,T);for(var Q=0;Q<S.length;Q++){if(S[Q]==null){SConnect.Marshaller.pushUShort(65535,T)}else{SConnect.Marshaller.pushString(S[Q],T)}}}break}P+=2}if(this.processInputStream!=null){T=this.processInputStream(T)}var B=[];SConnect.Marshaller.pushUByteArray(J,B);SConnect.Marshaller.pushUByteArray(T,B);var W;var M;if(B.length>255){var E=0;var L=B.length-1-2-1-4-2-2-2-G.length;var F=true;var N=B.length;var C=0;while(N>0){var V=L;var I=E;var A=255-1-2-8;var D=N>A?A:N;var K=new Array();if(F==true){var H=D-1-2-1-4-2-2-2-G.length;K[0]=216;SConnect.Marshaller.pushUShort(65535,K);SConnect.Marshaller.pushUInt(V,K);SConnect.Marshaller.pushUInt(H,K);for(var Q=C;Q<(C+D);Q++){K.push(B[Q])}F=false;E+=H}else{K[0]=216;SConnect.Marshaller.pushUShort(65535,K);SConnect.Marshaller.pushUInt(I,K);SConnect.Marshaller.pushUInt(D,K);for(var Q=C;Q<(C+D);Q++){K.push(B[Q])}E+=D}L=0;C=C+D;N=N-D;W=new Array();W[0]=128;W[1]=194;W[2]=0;W[3]=0;SConnect.Marshaller.pushUByte(K.length,W);SConnect.Marshaller.pushUByteArray(K,W);if(N==0){if((this.callback!=null)&&(this.callbackFinished==false)){this.argument=arguments[P];this.scope=this;this.scardComm.async_transmit(SConnect.TypeUtils.byteArrayToHexString(W),this);return }}M=this.scardComm.exchangeAPDU(SConnect.TypeUtils.byteArrayToHexString(W))}}else{W=new Array();W[0]=128;W[1]=194;W[2]=0;W[3]=0;SConnect.Marshaller.pushUByte(B.length,W);SConnect.Marshaller.pushUByteArray(B,W);if((this.callback!=null)&&(this.callbackFinished==false)){this.argument=arguments[P];this.scope=this;this.scardComm.async_transmit(SConnect.TypeUtils.byteArrayToHexString(W),this);return }else{M=this.scardComm.exchangeAPDU(SConnect.TypeUtils.byteArrayToHexString(W))}}return this.prepareResponse(arguments[P],M)},success:function(C){var I=C.dataOut;var F=C.statusWord.substr(0,2);var E=C.statusWord.substr(2,2);var H="";while(F=="61"||F=="91"){var D=null;if(F=="91"){D="A0"}else{D="00"}D+="C00000"+E;H=this.scardComm.transmit(D);F=H.statusWord.substr(0,2);E=H.statusWord.substr(2,2);I+=H.dataOut}var A={};A.statusWord=F+E;A.dataOut=I;var B=null;try{B=this.prepareResponse(this.argument,A)}catch(G){if(this.callback.failure){if(!this.callback.scope){this.callback.failure(G)}else{this.callback.failure.apply(this.callback.scope,[G])}}else{alert(G)}return }if(this.callback.success){this.callbackFinished=true;if(!this.callback.scope){this.callback.success(B)}else{this.callback.success.apply(this.callback.scope,[B])}}}}